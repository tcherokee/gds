---
import qs from 'qs'
import { urlTranslate } from '../../../utils/data-store.util'
import type { TranslationData } from "../../../interfaces/common/types.ts"
import { get } from 'svelte/store';
import { getTranslations } from '../../../stores/addTranslations';
import fetchApi from '../../../lib/strapi';
import { gamesQs } from "../../../qs/ssm-games"
import GameListBlock from '../../components/blocks/gameListBlock.svelte';
// import GameListBlock from '../../components/blocks/gameListBlock.astro';
import Pagination from '../../components/helpers/pagination.astro';

const { slug } = Astro.props

const query = qs.stringify(gamesQs(slug,"views:desc",1), {encodeValuesOnly: true});
const games = await fetchApi<any>({
    endpoint: 'games',
    isPaginated: true,
    query: `?${query}`
});

let siteID = import.meta.env.SITE_ID

const translationStore: TranslationData = getTranslations.get();

const gameBlock = {
    numberOfGames: 30,
    sortBy: "Most Popular",
    showGameFilterPanel: true,
    showGameMoreButton: true,
    gameCategories: [],
    gameProviders: [{
            slotProvider: {
                data: {
                    attributes: {
                        slug: slug
                    }
                }
            }
        }]
    
}
---
<GameListBlock data={gameBlock} translations={translationStore} client:load />

<Pagination
    currPage={games?.meta?.pagination?.page}
    pageCount={games?.meta?.pagination?.pageCount}
    path=`${urlTranslate[siteID as keyof typeof urlTranslate]['provider-pages']}/${slug}`
/>