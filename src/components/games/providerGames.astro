---
import qs from "qs";
import fetchApi from "../../../lib/strapi";
import { providerGamesQs } from "../../../qs/provider-games";
import type { Gamepage } from "../../../interfaces/game-page";
import GameListBlock from "../../components/blocks/gameListBlock.astro";

const { slug, translationStore } = Astro.props;
const query = qs.stringify(providerGamesQs(slug), { encodeValuesOnly: true });

const gamePage = await fetchApi<Gamepage[]>({
  endpoint: "games",
  wrappedByKey: "data",
  query: `?${query}`,
});

const gamesData = gamePage[0]?.attributes?.provider.data
  ? [...gamePage[0]?.attributes?.provider?.data?.attributes?.games?.data]
  : [];
const limitGames = gamesData.splice(0, 6);
---

<GameListBlock data={limitGames} {translationStore} />
