<script lang="ts">
  import { readMessages, messages, user } from "../../../stores/authStore";
  import type { TranslationData } from "../../../interfaces/common/types";

  import Link from "../helpers/link.svelte";
  import SignoutSvg from "~icons/kensho-dashboard-icons/signout";

  let activeRoute = "home";
  export let translations: TranslationData;
  export let pageUrl: string;
  export let source: "SIDE" | "FOOTER";
  

  const logoutHandler = async () => {
    const response = await fetch(`${import.meta.env.PUBLIC_FULL_URL}/api/auth/logout/`, {
      method: "POST",
      body: JSON.stringify({}),
    });
    location.reload();

    setTimeout(() => {
      user.set(null);
      readMessages.set([]);
      messages.set([]);
    }, 1000);
  };

  $: {
    const splittedUrlPathname = pageUrl.split("/");
    const lengthCheck = import.meta.env.BASE_URL ? 4 : 2;
    activeRoute =
      splittedUrlPathname.length > lengthCheck ? splittedUrlPathname[import.meta.env.BASE_URL ? 3 : 2] : "home";
  }
</script>

<!-- {activeRoute ===
      'home'
        ? 'text-menu-link-text-active'
        : ''} {source === 'SIDE' && activeRoute === 'home' ? 'bg-menu-link-bg-active' : ''} -->

<ul role="list" class="space-y-0.5">
  <li class="group {activeRoute === 'home' ? 'item-active' : ''}">
    <Link
      href="/dashboard/"
      classes="text-menu-link-text flex items-center gap-x-3 rounded-tl-md rounded-bl-md py-2.5 px-4 -mr-4 text-base font-medium group-[.item-active]:text-menu-link-text-active {source ===
      'SIDE'
        ? 'group-[.item-active]:bg-menu-link-bg-active'
        : ''}"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
      >
        <path
          d="M20.5153 9.72831L13.0153 2.65206C13.0116 2.64886 13.0082 2.64541 13.005 2.64175C12.7289 2.39062 12.369 2.25146 11.9958 2.25146C11.6225 2.25146 11.2627 2.39062 10.9866 2.64175L10.9763 2.65206L3.48469 9.72831C3.33187 9.86883 3.20989 10.0395 3.12646 10.2296C3.04303 10.4197 2.99997 10.6251 3 10.8327V19.4999C3 19.8977 3.15804 20.2792 3.43934 20.5605C3.72064 20.8418 4.10218 20.9999 4.5 20.9999H9C9.39782 20.9999 9.77936 20.8418 10.0607 20.5605C10.342 20.2792 10.5 19.8977 10.5 19.4999V14.9999H13.5V19.4999C13.5 19.8977 13.658 20.2792 13.9393 20.5605C14.2206 20.8418 14.6022 20.9999 15 20.9999H19.5C19.8978 20.9999 20.2794 20.8418 20.5607 20.5605C20.842 20.2792 21 19.8977 21 19.4999V10.8327C21 10.6251 20.957 10.4197 20.8735 10.2296C20.7901 10.0395 20.6681 9.86883 20.5153 9.72831ZM19.5 19.4999H15V14.9999C15 14.602 14.842 14.2205 14.5607 13.9392C14.2794 13.6579 13.8978 13.4999 13.5 13.4999H10.5C10.1022 13.4999 9.72064 13.6579 9.43934 13.9392C9.15804 14.2205 9 14.602 9 14.9999V19.4999H4.5V10.8327L4.51031 10.8233L12 3.74987L19.4906 10.8214L19.5009 10.8308L19.5 19.4999Z"
          fill="currentColor"
        />
      </svg>
      <span>Home</span>
    </Link>
  </li>
  <li
    class="group {activeRoute === 'most-played-games'
      ? 'item-active'
      : ''}"
  >
    <Link
      href="/dashboard/most-played-games/"
      classes="text-menu-link-text flex items-center gap-x-3 rounded-tl-md rounded-bl-md py-2.5 px-4 -mr-4 text-base font-medium group-[.item-active]:text-menu-link-text-active {source ===
      'SIDE'
        ? 'group-[.item-active]:bg-menu-link-bg-active'
        : ''}"
    >
      <svg
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M18.75 7.09125V3.75C18.75 3.35218 18.592 2.97064 18.3107 2.68934C18.0294 2.40804 17.6478 2.25 17.25 2.25H6.75C6.35218 2.25 5.97064 2.40804 5.68934 2.68934C5.40804 2.97064 5.25 3.35218 5.25 3.75V7.125C5.25051 7.35778 5.30495 7.58727 5.40905 7.79548C5.51315 8.00368 5.66408 8.18493 5.85 8.325L10.7503 12L5.85 15.675C5.66408 15.8151 5.51315 15.9963 5.40905 16.2045C5.30495 16.4127 5.25051 16.6422 5.25 16.875V20.25C5.25 20.6478 5.40804 21.0294 5.68934 21.3107C5.97064 21.592 6.35218 21.75 6.75 21.75H17.25C17.6478 21.75 18.0294 21.592 18.3107 21.3107C18.592 21.0294 18.75 20.6478 18.75 20.25V16.9088C18.7495 16.6769 18.6955 16.4482 18.5922 16.2406C18.489 16.033 18.3393 15.8519 18.1547 15.7116L13.2441 12L18.1547 8.2875C18.3393 8.14742 18.4891 7.96658 18.5924 7.75908C18.6957 7.55158 18.7496 7.32303 18.75 7.09125ZM17.25 20.25H6.75V16.875L12 12.9375L17.25 16.9078V20.25ZM17.25 7.09125L12 11.0625L6.75 7.125V3.75H17.25V7.09125Z"
          fill="currentColor"
        />
      </svg>
      <span>{translations?.mostPlayed}</span>
    </Link>
  </li>
  <li
    class="group {activeRoute === 'favourite-games'
      ? 'item-active'
      : ''}"
  >
    <Link
      href="/dashboard/favourite-games/"
      classes="text-menu-link-text flex items-center gap-x-3 rounded-tl-md rounded-bl-md py-2.5 px-4 -mr-4 text-base font-medium group-[.item-active]:text-menu-link-text-active {source ===
      'SIDE'
        ? 'group-[.item-active]:bg-menu-link-bg-active'
        : ''}"
    >
      <svg
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M16.6875 3C14.7516 3 13.0566 3.8325 12 5.23969C10.9434 3.8325 9.24844 3 7.3125 3C5.77146 3.00174 4.29404 3.61468 3.20436 4.70436C2.11468 5.79404 1.50174 7.27146 1.5 8.8125C1.5 15.375 11.2303 20.6869 11.6447 20.9062C11.7539 20.965 11.876 20.9958 12 20.9958C12.124 20.9958 12.2461 20.965 12.3553 20.9062C12.7697 20.6869 22.5 15.375 22.5 8.8125C22.4983 7.27146 21.8853 5.79404 20.7956 4.70436C19.706 3.61468 18.2285 3.00174 16.6875 3ZM12 19.3875C10.2881 18.39 3 13.8459 3 8.8125C3.00149 7.66921 3.45632 6.57317 4.26475 5.76475C5.07317 4.95632 6.16921 4.50149 7.3125 4.5C9.13594 4.5 10.6669 5.47125 11.3062 7.03125C11.3628 7.16881 11.4589 7.28646 11.5824 7.36926C11.7059 7.45207 11.8513 7.49627 12 7.49627C12.1487 7.49627 12.2941 7.45207 12.4176 7.36926C12.5411 7.28646 12.6372 7.16881 12.6937 7.03125C13.3331 5.46844 14.8641 4.5 16.6875 4.5C17.8308 4.50149 18.9268 4.95632 19.7353 5.76475C20.5437 6.57317 20.9985 7.66921 21 8.8125C21 13.8384 13.71 18.3891 12 19.3875Z"
          fill="currentColor"
        />
      </svg>
      <span>{translations?.favouriteGame}</span>
    </Link>
  </li>
  <li
    class="group {activeRoute === 'weekly-pick'
      ? 'item-active'
      : ''}"
  >
    <Link
      href="/dashboard/weekly-pick/"
      classes="text-menu-link-text flex items-center gap-x-3 rounded-tl-md rounded-bl-md py-2.5 px-4 -mr-4 text-base font-medium group-[.item-active]:text-menu-link-text-active {source ===
      'SIDE'
        ? 'group-[.item-active]:bg-menu-link-bg-active'
        : ''}"
    >
      <svg
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M22.4251 9.12075C22.3342 8.8408 22.1631 8.59375 21.9328 8.41038C21.7026 8.22701 21.4236 8.11542 21.1304 8.0895L15.5626 7.6095L13.3801 2.4195C13.2664 2.14717 13.0748 1.91455 12.8292 1.75093C12.5836 1.58731 12.2952 1.5 12.0001 1.5C11.705 1.5 11.4165 1.58731 11.1709 1.75093C10.9254 1.91455 10.7337 2.14717 10.6201 2.4195L8.44413 7.6095L2.86976 8.09231C2.57542 8.11705 2.29493 8.22813 2.06347 8.41164C1.83201 8.59515 1.65988 8.84291 1.56867 9.12385C1.47746 9.4048 1.47122 9.70642 1.55075 9.99089C1.63027 10.2754 1.79202 10.53 2.01569 10.7229L6.24476 14.4186L4.97726 19.9067C4.91023 20.1939 4.92936 20.4945 5.03224 20.7709C5.13512 21.0472 5.31719 21.2872 5.55569 21.4606C5.79419 21.6341 6.07853 21.7334 6.37317 21.7462C6.66781 21.7589 6.95967 21.6845 7.21226 21.5323L11.9935 18.6261L16.7851 21.5323C17.0377 21.6845 17.3295 21.7589 17.6242 21.7462C17.9188 21.7334 18.2031 21.6341 18.4416 21.4606C18.6801 21.2872 18.8622 21.0472 18.9651 20.7709C19.068 20.4945 19.0871 20.1939 19.0201 19.9067L17.7535 14.4129L21.9816 10.7229C22.2053 10.5294 22.3667 10.274 22.4456 9.98889C22.5245 9.70382 22.5174 9.40178 22.4251 9.12075ZM20.9982 9.5895L16.7701 13.2795C16.5643 13.4585 16.4112 13.6902 16.3273 13.9497C16.2434 14.2092 16.2318 14.4867 16.2938 14.7523L17.5641 20.2498L12.7763 17.3436C12.5427 17.2013 12.2745 17.1261 12.001 17.1261C11.7275 17.1261 11.4593 17.2013 11.2257 17.3436L6.44444 20.2498L7.70632 14.7561C7.76834 14.4905 7.75676 14.213 7.67285 13.9535C7.58893 13.694 7.43585 13.4623 7.23007 13.2833L3.00007 9.59513C2.99973 9.59232 2.99973 9.58949 3.00007 9.58669L8.57257 9.10481C8.84463 9.08083 9.10499 8.98303 9.32555 8.82194C9.54611 8.66086 9.7185 8.44262 9.82413 8.19075L12.0001 3.00731L14.1751 8.19075C14.2807 8.44262 14.4531 8.66086 14.6737 8.82194C14.8942 8.98303 15.1546 9.08083 15.4266 9.10481L21.0001 9.58669C21.0001 9.58669 21.0001 9.59231 21.0001 9.59325L20.9982 9.5895Z"
          fill="currentColor"
        />
      </svg>

      <span>{translations?.pickOfTheWeek}</span>
    </Link>
  </li>
  <li
    class="group {activeRoute === 'messages'
      ? 'item-active'
      : ''}"
  >
    <Link
      href="/dashboard/messages/"
      classes="text-menu-link-text flex items-center gap-x-3 rounded-tl-md rounded-bl-md py-2.5 px-4 -mr-4 text-base font-medium group-[.item-active]:text-menu-link-text-active {source ===
      'SIDE'
        ? 'group-[.item-active]:bg-menu-link-bg-active'
        : ''}"
    >
      <svg
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M20.25 7.5H17.25V4.5C17.25 4.10218 17.092 3.72064 16.8107 3.43934C16.5294 3.15804 16.1478 3 15.75 3H3.75C3.35218 3 2.97064 3.15804 2.68934 3.43934C2.40804 3.72064 2.25 4.10218 2.25 4.5V16.5C2.25044 16.6411 2.29068 16.7792 2.36608 16.8985C2.44149 17.0177 2.54901 17.1133 2.67629 17.1742C2.80358 17.2351 2.94546 17.2589 3.08564 17.2428C3.22581 17.2266 3.3586 17.1713 3.46875 17.0831L6.75 14.4375V17.25C6.75 17.6478 6.90804 18.0294 7.18934 18.3107C7.47064 18.592 7.85218 18.75 8.25 18.75H17.0241L20.5312 21.5831C20.664 21.6905 20.8293 21.7493 21 21.75C21.1989 21.75 21.3897 21.671 21.5303 21.5303C21.671 21.3897 21.75 21.1989 21.75 21V9C21.75 8.60218 21.592 8.22064 21.3107 7.93934C21.0294 7.65804 20.6478 7.5 20.25 7.5ZM6.23906 12.9169L3.75 14.9297V4.5H15.75V12.75H6.71063C6.53897 12.75 6.37252 12.8089 6.23906 12.9169ZM20.25 19.4297L17.7609 17.4169C17.6282 17.3095 17.4629 17.2507 17.2922 17.25H8.25V14.25H15.75C16.1478 14.25 16.5294 14.092 16.8107 13.8107C17.092 13.5294 17.25 13.1478 17.25 12.75V9H20.25V19.4297Z"
          fill="#9FCBEE"
        />
      </svg>

      <span>{translations?.message}</span>
      {#if $messages.length - $readMessages.length > 0}
        <div
          class="flex px-2 py-[1px] h-6 min-h-6 !rounded-full btn-secondary justify-center items-center"
        >
          <span>{$messages.length - $readMessages.length}</span>
        </div>
      {/if}
    </Link>
  </li>
  <li>
    <Link
      href="/contact-us/"
      classes="text-menu-link-text flex items-center gap-x-3 rounded-tl-md rounded-bl-md py-2.5 px-4 -mr-4 text-base font-medium"
    >
      <svg
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M12 2.25C10.0716 2.25 8.18657 2.82183 6.58319 3.89317C4.97982 4.96451 3.73013 6.48726 2.99218 8.26884C2.25422 10.0504 2.06114 12.0108 2.43735 13.9021C2.81355 15.7934 3.74215 17.5307 5.10571 18.8943C6.46928 20.2579 8.20656 21.1865 10.0979 21.5627C11.9892 21.9389 13.9496 21.7458 15.7312 21.0078C17.5127 20.2699 19.0355 19.0202 20.1068 17.4168C21.1782 15.8134 21.75 13.9284 21.75 12C21.7473 9.41498 20.7192 6.93661 18.8913 5.10872C17.0634 3.28084 14.585 2.25273 12 2.25ZM15.6656 14.6053C16.2083 13.8449 16.4999 12.9341 16.4999 12C16.4999 11.0659 16.2083 10.155 15.6656 9.39469L18.3375 6.72375C19.5732 8.20427 20.2501 10.0715 20.2501 12C20.2501 13.9285 19.5732 15.7957 18.3375 17.2762L15.6656 14.6053ZM9 12C9 11.4067 9.17595 10.8266 9.5056 10.3333C9.83524 9.83994 10.3038 9.45542 10.852 9.22836C11.4001 9.0013 12.0033 8.94189 12.5853 9.05764C13.1672 9.1734 13.7018 9.45912 14.1213 9.87868C14.5409 10.2982 14.8266 10.8328 14.9424 11.4147C15.0581 11.9967 14.9987 12.5999 14.7716 13.1481C14.5446 13.6962 14.1601 14.1648 13.6667 14.4944C13.1734 14.8241 12.5933 15 12 15C11.2044 15 10.4413 14.6839 9.87868 14.1213C9.31607 13.5587 9 12.7956 9 12ZM17.2763 5.6625L14.6053 8.33438C13.845 7.79174 12.9341 7.50007 12 7.50007C11.0659 7.50007 10.1551 7.79174 9.39469 8.33438L6.72375 5.6625C8.20427 4.42678 10.0715 3.74991 12 3.74991C13.9285 3.74991 15.7957 4.42678 17.2763 5.6625ZM5.6625 6.72375L8.33438 9.39469C7.79175 10.155 7.50007 11.0659 7.50007 12C7.50007 12.9341 7.79175 13.8449 8.33438 14.6053L5.6625 17.2762C4.42678 15.7957 3.74991 13.9285 3.74991 12C3.74991 10.0715 4.42678 8.20427 5.6625 6.72375ZM6.72375 18.3375L9.39469 15.6656C10.1551 16.2083 11.0659 16.4999 12 16.4999C12.9341 16.4999 13.845 16.2083 14.6053 15.6656L17.2763 18.3375C15.7957 19.5732 13.9285 20.2501 12 20.2501C10.0715 20.2501 8.20427 19.5732 6.72375 18.3375Z"
          fill="currentColor"
        />
      </svg>

      <span>{translations?.contactUs}</span>
    </Link>
  </li>
  <li class="md:hidden">
    <button class="flex justify-between gap-x-3 px-4 py-2.5" on:click={logoutHandler}>
      <SignoutSvg class="shrink-0 w-6 h-6 text-blue-100" />
      <div class="text-menu-link-text text-base">Logout</div>
    </button>
  </li>
</ul>
