---
import MainLayout from "../../layouts/MainLayout.astro";
import { getTranslations } from "../../../utils/api-requests";
import { tournamentApi } from "../../../lib/tournamentapi";
import type { Tournament, TournamentResponse } from "../../../interfaces/tournaments";
import Breadcrumb from "../../components/layout/breadcrumbs.astro";
import PastResults from "../../components/tournaments/pastResults.astro";

const translationStore = await getTranslations();

// Get tournament results using the tournament API
const getTournamentResults = async () => {
  return tournamentApi<TournamentResponse>("getTournamentResults");
};

let tournaments: Tournament[] = [];
try {
  const tournamentResultsResponse = await getTournamentResults();
  tournaments = tournamentResultsResponse.data || [];
} catch (e) {
  console.error("Error fetching tournament results:", e);
}

const seo = {
  pageTitle: translationStore?.tournamentResultsTitle || "Tournament Results",
  metaDescription:
    translationStore?.tournamentResultsDescription ||
    "View past tournament results",
  url: `${import.meta.env.PUBLIC_FULL_URL}/tournaments/results`,
};

const breadcrumbs = [
  { title: translationStore?.home || "Home", href: "/" },
  {
    title: translationStore?.tournaments || "Tournaments",
    href: "/tournaments",
  },
  {
    title: translationStore?.results || "Results",
    href: "/tournaments/results",
    current: true,
  },
];
---

<MainLayout seoData={seo}>
  <!-- Header Section -->
  <div class="featured-background curve">
    <div class="xl:container content-auto px-4 py-12">
      <Breadcrumb breadcrumbs={breadcrumbs} />
      
      <div class="max-w-4xl mx-auto text-center mt-8">
        <h1 class="text-4xl md:text-5xl font-bold text-white mb-4">
          {translationStore?.tournamentResultsTitle || "Tournament Results"}
        </h1>
        <p class="text-lg text-gray-300">
          {translationStore?.tournamentResultsDescription || "View the results of our past tournaments"}
        </p>
      </div>
    </div>
  </div>

  <!-- Results Table Section -->
  <div class="xl:container content-auto px-4">
    <PastResults tournaments={tournaments} />
  </div>
</MainLayout>

